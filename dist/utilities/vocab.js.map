{"version":3,"sources":["../../src/utilities/vocab.js"],"names":["Vocab","values","maxThreshold","undefined","indexTable","characterTable","characters","buildCharactersFromIterable","buildTables","tempCharactersTable","vocabIndex","vocabLength","length","hasOwnProperty","characterIndex","charactersLength","character","push","value","result","i","max","index","Error","value1","value2","toIndexes","split","concat","indices","toCharacters","join","special","vocabVariableName","toString","replace","toIndexesInputOutput","String","fromCharCode","vocab","fromAllPrintable","addSpecial","string","prototype","Set","array","filter","v","a","indexOf","sort","json"],"mappings":"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","file":"vocab.js","sourcesContent":["/**\n *\n * @param {String[]|Number[]} values\n * @param maxThreshold\n * @constructor\n */\nexport default class Vocab {\n  constructor(values, maxThreshold = 0) {\n    if (values === undefined) return;\n\n    this.values = values;\n    // go over all characters and keep track of all unique ones seen\n    // count up all characters\n    this.indexTable = {};\n    this.characterTable = {};\n    this.characters = [];\n    this.buildCharactersFromIterable(values);\n    this.buildTables(maxThreshold);\n  }\n\n  buildCharactersFromIterable(values) {\n    let tempCharactersTable = {};\n    for (let vocabIndex = 0, vocabLength = values.length; vocabIndex < vocabLength; vocabIndex++) {\n      let characters = values[vocabIndex];\n\n      if (characters.hasOwnProperty('length')) {\n        for (let characterIndex = 0, charactersLength = characters.length; characterIndex < charactersLength; characterIndex++) {\n          let character = characters[characterIndex];\n          if (tempCharactersTable.hasOwnProperty(character)) continue;\n          tempCharactersTable[character] = true;\n          this.characters.push(character);\n        }\n      } else {\n        let character = values[vocabIndex];\n        if (tempCharactersTable.hasOwnProperty(character)) continue;\n        tempCharactersTable[vocabIndex] = true;\n        this.characters.push(character);\n      }\n    }\n  }\n\n  buildTables(maxThreshold) {\n    // filter by count threshold and create pointers\n    let charactersLength = this.characters.length;\n    for(let characterIndex = 0; characterIndex < charactersLength; characterIndex++) {\n      let character = this.characters[characterIndex];\n      if(characterIndex >= maxThreshold) {\n        // add character to vocab\n        this.indexTable[character] = characterIndex;\n        this.characterTable[characterIndex] = character;\n      }\n    }\n  }\n\n  toIndexes(value, maxThreshold = 0) {\n    let result = [];\n    let indexTable = this.indexTable;\n\n    for (let i = 0, max = value.length; i < max; i++) {\n      let character = value[i];\n      let index = indexTable[character];\n      if (index === undefined) {\n        throw new Error(`unrecognized character \"${ character }\"`);\n      }\n      if (index < maxThreshold) continue;\n      result.push(index);\n    }\n\n    return result;\n  }\n\n  toIndexesInputOutput(value1, value2 = null, maxThreshold = 0) {\n    let result;\n    if (typeof value1 === 'string') {\n      result = this.toIndexes(value1.split('').concat(['stop-input', 'start-output']), maxThreshold);\n    } else {\n      result = this.toIndexes(value1.concat(['stop-input', 'start-output']), maxThreshold);\n    }\n\n    if (value2 === null) return result;\n\n    if (typeof value2 === 'string') {\n      return result.concat(this.toIndexes(value2.split(''), maxThreshold));\n    } else {\n      return result.concat(this.toIndexes(value2, maxThreshold));\n    }\n  }\n\n  toCharacters(indices, maxThreshold = 0) {\n    let result = [];\n    let characterTable = this.characterTable;\n\n    for (let i = 0, max = indices.length; i < max; i++) {\n      let index = indices[i];\n      if (index < maxThreshold) continue;\n      let character = characterTable[index];\n      if (character === undefined) {\n        throw new Error(`unrecognized index \"${ index }\"`);\n      }\n      result.push(character);\n    }\n\n    return result;\n  }\n\n  toString(indices, maxThreshold) {\n    return this.toCharacters(indices, maxThreshold).join('');\n  }\n\n  static fromAllPrintable(maxThreshold, values = ['\\n']) {\n    for(let i = 32; i <= 126; i++) {\n      values.push(String.fromCharCode(i));\n    }\n    return new Vocab(values, maxThreshold);\n  }\n\n  static fromAllPrintableInputOutput(maxThreshold, values = ['\\n']) {\n    const vocab = Vocab.fromAllPrintable(maxThreshold, values);\n    vocab.addSpecial('stop-input');\n    vocab.addSpecial('start-output');\n    return vocab;\n  }\n\n  static fromStringInputOutput(string, maxThreshold) {\n    const values = String.prototype.concat(...new Set(string));\n    const vocab = new Vocab(values, maxThreshold);\n    vocab.addSpecial('stop-input');\n    vocab.addSpecial('start-output');\n    return vocab;\n  }\n\n  static fromArrayInputOutput(array, maxThreshold) {\n    const vocab = new Vocab(array.filter((v, i, a) => a.indexOf(v) === i).sort(), maxThreshold);\n    vocab.addSpecial('stop-input');\n    vocab.addSpecial('start-output');\n    return vocab;\n  }\n\n  static fromString(string, maxThreshold) {\n    const values = String.prototype.concat(...new Set(string));\n    return new Vocab(values, maxThreshold);\n  }\n\n  static fromJSON(json) {\n    const vocab = new Vocab();\n    vocab.indexTable = json.indexTable;\n    vocab.characterTable = json.characterTable;\n    vocab.values = json.values;\n    vocab.characters = json.characters;\n    return vocab;\n  }\n\n  addSpecial(special) {\n    let i = this.indexTable[special] = this.characters.length;\n    this.characterTable[i] = special;\n    this.characters.push(special);\n  }\n\n  toFunctionString(vocabVariableName) {\n    return `\n${ this.toIndexes.toString().replace('this', vocabVariableName) }\n${ this.toIndexesInputOutput.toString().replace('this', vocabVariableName) }\n${ this.toCharacters.toString().replace('this', vocabVariableName) }\n`;\n  }\n}\n"]}