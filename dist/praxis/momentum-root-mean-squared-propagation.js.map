{"version":3,"sources":["../../src/praxis/momentum-root-mean-squared-propagation.js"],"names":["MomentumRootMeanSquaredPropagation","decayRate","regularizationStrength","layer","settings","width","height","momentums","Object","assign","constructor","defaults","weights","deltas","output","momentumsKernel","result","momentumRootMeanSquaredPropagation","map","getMomentum","MRmsProp","previousMomentums","delta","thread","y","x","weight","previousMomentum","momentum","constants","learningRate","Math","sqrt","smoothEps","decay"],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;;;;;IAEqBA,kC;;;wBACG;AACpB,aAAO;AACLC,mBAAW,KADN;AAELC,gCAAwB;AAFnB,OAAP;AAID;;;AAED,8CAAYC,KAAZ,EAAkC;AAAA,QAAfC,QAAe,uEAAJ,EAAI;;AAAA;;AAChC,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKE,KAAL,GAAaF,MAAME,KAAnB;AACA,SAAKC,MAAL,GAAcH,MAAMG,MAApB;AACA,SAAKC,SAAL,GAAiB,uBAAQJ,MAAME,KAAd,EAAqBF,MAAMG,MAA3B,CAAjB;AACAE,WAAOC,MAAP,CAAc,IAAd,EAAoB,KAAKC,WAAL,CAAiBC,QAArC,EAA+CP,QAA/C;AACD;;;;wBAEGQ,O,EAASC,M,EAAQ;AACnB,UAAMC,SAAS,KAAKC,eAAL,CAAqBH,OAArB,EAA8BC,MAA9B,EAAsC,KAAKN,SAA3C,EAAsD,KAAKN,SAA3D,EAAsE,KAAKC,sBAA3E,CAAf;AACA,WAAKK,SAAL,GAAiBO,OAAOP,SAAxB;AACA,aAAOO,OAAOE,MAAd;AACD;;;mCAEc;AACb,WAAKD,eAAL,GAAuB,0BAAWE,kCAAX,EAA+C;AACpEH,gBAAQ,CAAC,KAAKT,KAAN,EAAa,KAAKC,MAAlB,CAD4D;AAEpEY,aAAK;AACHX,qBAAWY;AADR;AAF+D,OAA/C,CAAvB;AAMD;;;;;;AAGH;;;;;;kBAhCqBnB,kC;AAoCrB,IAAMoB,WAAWpB,kCAAjB;;AAEA;;;;AAIA,SAASiB,kCAAT,CAA4CL,OAA5C,EAAqDC,MAArD,EAA6DQ,iBAA7D,EAAgFpB,SAAhF,EAA2FC,sBAA3F,EAAmH;AACjH,MAAIoB,QAAQT,OAAO,KAAKU,MAAL,CAAYC,CAAnB,EAAsB,KAAKD,MAAL,CAAYE,CAAlC,CAAZ;AACA,MAAIC,SAASd,QAAQ,KAAKW,MAAL,CAAYC,CAApB,EAAuB,KAAKD,MAAL,CAAYE,CAAnC,CAAb;AACA,MAAIE,mBAAmBN,kBAAkB,KAAKE,MAAL,CAAYC,CAA9B,EAAiC,KAAKD,MAAL,CAAYE,CAA7C,CAAvB;AACA,MAAMG,WAAWT,YAAYG,KAAZ,EAAmBrB,SAAnB,EAA8B0B,gBAA9B,CAAjB;AACA,SAAOD,SAAS,CAAC,KAAKG,SAAL,CAAeC,YAAhB,GAA+BR,KAA/B,GAAuCS,KAAKC,IAAL,CAAUJ,WAAW,KAAKC,SAAL,CAAeI,SAApC,CAAhD,GAAiG/B,yBAAyBwB,MAAjI;AACD;;AAED,SAASP,WAAT,CAAqBG,KAArB,EAA4BY,KAA5B,EAAmCP,gBAAnC,EAAqD;AACnD,SAAOA,mBAAmBO,KAAnB,GAA2B,CAAC,IAAIA,KAAL,IAAcZ,KAAd,GAAsBA,KAAxD;AACD;;QAGCH,W,GAAAA,W;QACAC,Q,GAAAA,Q","file":"momentum-root-mean-squared-propagation.js","sourcesContent":["import makeKernel from '../utilities/make-kernel';\nimport zeros2d from \"../utilities/zeros-2d\";\n\nexport default class MomentumRootMeanSquaredPropagation {\n  static get defaults() {\n    return {\n      decayRate: 0.999,\n      regularizationStrength: 0.00001\n    };\n  }\n\n  constructor(layer, settings = {}) {\n    this.layer = layer;\n    this.width = layer.width;\n    this.height = layer.height;\n    this.momentums = zeros2d(layer.width, layer.height);\n    Object.assign(this, this.constructor.defaults, settings);\n  }\n\n  run(weights, deltas) {\n    const output = this.momentumsKernel(weights, deltas, this.momentums, this.decayRate, this.regularizationStrength);\n    this.momentums = output.momentums;\n    return output.result;\n  }\n\n  setupKernels() {\n    this.momentumsKernel = makeKernel(momentumRootMeanSquaredPropagation, {\n      output: [this.width, this.height],\n      map: {\n        momentums: getMomentum\n      }\n    })\n  }\n}\n\n/**\n * @description Mathematician friendly name of MomentumRootMeanSquaredPropagation class. For those that are not mere mortals\n * @type {MomentumRootMeanSquaredPropagation}\n */\nconst MRmsProp = MomentumRootMeanSquaredPropagation;\n\n/**\n * @description Momentum Root Mean Square Propagation Function\n * @returns {number}\n */\nfunction momentumRootMeanSquaredPropagation(weights, deltas, previousMomentums, decayRate, regularizationStrength) {\n  let delta = deltas[this.thread.y][this.thread.x];\n  let weight = weights[this.thread.y][this.thread.x];\n  let previousMomentum = previousMomentums[this.thread.y][this.thread.x];\n  const momentum = getMomentum(delta, decayRate, previousMomentum);\n  return weight + -this.constants.learningRate * delta / Math.sqrt(momentum + this.constants.smoothEps) - regularizationStrength * weight;\n}\n\nfunction getMomentum(delta, decay, previousMomentum) {\n  return previousMomentum * decay + (1 - decay) * delta * delta;\n}\n\nexport {\n  getMomentum,\n  MRmsProp\n};\n"]}