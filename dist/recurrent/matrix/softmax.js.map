{"version":3,"sources":["../../../src/recurrent/matrix/softmax.js"],"names":["softmax","m","result","rows","columns","maxVal","i","max","weights","length","s","Math","exp","recurrence"],"mappings":";;;;;kBAMwBA,O;;AANxB;;;;;;AACA;;;;;AAKe,SAASA,OAAT,CAAiBC,CAAjB,EAAoB;AACjC,MAAIC,SAAS,eAAWD,EAAEE,IAAb,EAAmBF,EAAEG,OAArB,CAAb,CADiC,CACW;AAC5C,MAAIC,SAAS,CAAC,MAAd;AACA,MAAIC,UAAJ;AACA,MAAIC,YAAJ;;AAEA,OAAKD,IAAI,CAAJ,EAAOC,MAAMN,EAAEO,OAAF,CAAUC,MAA5B,EAAoCH,IAAIC,GAAxC,EAA6CD,GAA7C,EAAkD;AAChD,QAAGL,EAAEO,OAAF,CAAUF,CAAV,KAAgBD,MAAnB,EAA2B;AAC3BA,aAASJ,EAAEO,OAAF,CAAUF,CAAV,CAAT;AACD;;AAED,MAAII,IAAI,CAAR;AACA,OAAKJ,IAAI,CAAJ,EAAOC,MAAMN,EAAEO,OAAF,CAAUC,MAA5B,EAAoCH,IAAIC,GAAxC,EAA6CD,GAA7C,EAAkD;AAChDJ,WAAOM,OAAP,CAAeF,CAAf,IAAoBK,KAAKC,GAAL,CAASX,EAAEO,OAAF,CAAUF,CAAV,IAAeD,MAAxB,CAApB;AACAK,SAAKR,OAAOM,OAAP,CAAeF,CAAf,CAAL;AACD;;AAED,OAAKA,IAAI,CAAJ,EAAOC,MAAMN,EAAEO,OAAF,CAAUC,MAA5B,EAAoCH,IAAIC,GAAxC,EAA6CD,GAA7C,EAAkD;AAChDJ,WAAOM,OAAP,CAAeF,CAAf,KAAqBI,CAArB;AACAR,WAAOW,UAAP,CAAkBP,CAAlB,IAAuB,CAAvB;AACD;;AAED;AACA;AACA;AACA,SAAOJ,MAAP;AACD","file":"softmax.js","sourcesContent":["import Matrix from './';\n/**\n *\n * @param {Matrix} m\n * @returns {Matrix}\n */\nexport default function softmax(m) {\n  let result = new Matrix(m.rows, m.columns); // probability volume\n  let maxVal = -999999;\n  let i;\n  let max;\n\n  for (i = 0, max = m.weights.length; i < max; i++) {\n    if(m.weights[i] <= maxVal) continue;\n    maxVal = m.weights[i];\n  }\n\n  let s = 0;\n  for (i = 0, max = m.weights.length; i < max; i++) {\n    result.weights[i] = Math.exp(m.weights[i] - maxVal);\n    s += result.weights[i];\n  }\n\n  for (i = 0, max = m.weights.length; i < max; i++) {\n    result.weights[i] /= s;\n    result.recurrence[i] = 0;\n  }\n\n  // no backward pass here needed\n  // since we will use the computed probabilities outside\n  // to set gradients directly on m\n  return result;\n}\n"]}