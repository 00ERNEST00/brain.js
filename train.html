<!DOCTYPE html>
<html>
<head>
<script src="brain.js"></script>
<style>

body {
  font-family: "Myriad Pro", Corbel, Tahoma, "Lucida Grande", "Bitstream Vera Sans", Arial, Helvetica, sans-serif;
  font-size: 85%;
}

#container {
  margin: 0 auto;
  width: 800px;
}

#black-swatch {
  color: black;
}

#white-swatch {
  color: white;
}

.section {
  margin: 50px;
  text-align: center;
}

.section-header {
  margin-bottom: 20px;
  font-size: 1.2em;
}

#swatches {
  display: -moz-box;
  -moz-box-orient: horizontal;
  -webkit-box-orient: horizontal;
}

.swatch:active {
   -moz-box-shadow: 0 0 2px 3px grey;
-webkit-box-shadow: 0 0 2px 3px grey;
        box-shadow: 0 0 2px 3px grey;
}

.swatch {
  margin: 10px;
  padding: 20px;
  width: 140px;
  height: 140px;
  cursor: pointer;
}


#pass-button {
  color: #333;
  margin-left: 280px;
  font-size: 1.5em;
}

#test-button {
  background-color: #EEE;
  margin-top: 30px;
}

.button:active {
  background-color: #BBB !important;
}

.button {
  padding: 6px 14px;
  margin: 10px;
  -moz-border-radius: 4px;
  -webkit-border-radius: 4px;
  cursor: pointer;
  display: inline-block;
}

</style>
<script>
  var color;
  var training = [];

  function pickSwatch(textColor) {
    var input = normalize(color);
    var target = { black_text: textColor == 'black' ? 1 : 0};
    training.push({input: input, target: target});

    changeColor();
  }

  function randomColor() {
    return { red: Math.round(Math.random() * 255), 
             green: Math.round(Math.random() * 255),
             blue: Math.round(Math.random() * 255)};
  }

  function toRgb(color) {
    return "rgb(" + color.red + "," + color.green + "," + color.blue + ")";
  }

  function normalize(color) {
    return { red: color.red / 255, green: color.green / 255, blue: color.blue / 255 };
  }

  function changeColor() {
    color = randomColor(); 
    var rgb = toRgb(color);
    document.getElementById("black-swatch").style.backgroundColor = rgb;
    document.getElementById("white-swatch").style.backgroundColor = rgb;
  }

  function testNetwork() {
    net = new NeuralNetwork({ hiddenLayers: [3]});
    net.train(training);
  }

  function testColor(color) {
    var rgb = toRgb(color);
    document.getElementById("nn-swatch").style.backgroundColor = rgb;
    document.getElementById("wcag-swatch").style.backgroundColor = rgb;
  
    document.getElementById("nn-swatch").style.color = nnText(color);
    document.getElementById("wcag-swatch").style.color = wcagText(color);  
  }
  
  function nnText(color) {
    return net.run(normalize(color)).black_text > .5 ? 'black' : 'white';
  }

  function wcagText(color) {
    if(contrast(color, {red: 255, green: 255, blue: 255}) 
       > contrast(color, {red: 0, green: 0, blue: 0}))
      return 'white';
    return 'black';
  }

  function luminosity(color) {
    var color = normalize(color);
    var r = color.red, g = color.green, b = color.blue;
    var red = (r <= 0.03928) ? r/12.92 : Math.pow(((r + 0.055)/1.055), 2.4);
    var green = (g <= 0.03928) ? g/12.92 : Math.pow(((g + 0.055)/1.055), 2.4);
    var blue = (b <= 0.03928) ? b/12.92 : Math.pow(((b + 0.055)/1.055), 2.4);

    return 0.2126 * red + 0.7152 * green + 0.0722 * blue;
  }

  function contrast(color1, color2) {
    var lum1 = luminosity(color1);
    var lum2 = luminosity(color2);
    if(lum1 > lum2)
      return (lum1 + 0.05) / (lum2 + 0.05);
    return (lum2 + 0.05) / (lum1 + 0.05);
  }

  function testRandom() {
    testColor(randomColor());
  }

</script>
</head>
<body onload="changeColor();">
  <div id="container">
    <div class="section" id="training-box">
      <div class="section-header">
        Which one can you read more easily?
      </div>
	    <div id="swatches">
		    <div id="black-swatch" class="swatch" onclick="pickSwatch('black');">
		      <div class="swatch-text">This one</div>
		    </div>
		    <div id="white-swatch" class="swatch" onclick="pickSwatch('white');">
		      <div class="swatch-text">This one</div>
		    </div>
	    </div>
        <div id="training-buttons">
          <span id="pass-button" onclick="changeColor();" class="button" title="skip">&rarr;</span>
          
        </div><span id="test-button" onclick="testNetwork();" class="button">test neural network</span>
    </div>

    <div class="section" id="testing-box">
       <span class="button" onclick="testRandom();">random</span>
       <div id="swatches">
		    <div id="nn-swatch" class="swatch">
		      <div class="swatch-text">neural network</div>
		    </div>
		    <div id="wcag-swatch" class="swatch">
		      <div class="swatch-text">luminosity algorithm</div>
		    </div>
	    </div>
    </div>
  </div>
</body>
</html>
